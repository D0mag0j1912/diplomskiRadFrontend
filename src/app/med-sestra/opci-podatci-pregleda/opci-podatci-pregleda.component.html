<div class="row">
    <div class="col-xs-12 col-md-10 col-md-offset-1">
        <!--Prikaziva se prozor sa otvorenim slučajevima-->
        <app-otvoreni-slucaj
            *ngIf="otvoren"
            (close)="onCloseCase()"
            (podatciRetka)="onPoveziOtvoreniSlucaj($event)"
            [otvoreniSlucaji]="otvoreniSlucaji"
            [sekDijagnoze]="sekDijagnoze"
            [idAktivniPacijent]="idPacijent"></app-otvoreni-slucaj>
        <form (ngSubmit)="onSubmit()" [formGroup]="forma">
            <div class="table-responsive-sm">
                <table class="table table-striped">
                    <tbody>
                        <tr>
                            <td>
                                <label
                                    for="nacinPlacanja"
                                    style="font-family: Verdana, sans-serif;">Način plaćanja:</label>
                            </td>
                            <td>
                                <input
                                    type="radio"
                                    value="hzzo"
                                    formControlName="nacinPlacanja">HZZO
                            </td>
                            <td>
                                <select class="form-control" style="width:200px;height:35px;margin-left:-250px;" formControlName="podrucniUred">
                                    <option [disabled]="true" [ngValue]="null">Odaberite područni ured</option>
                                    <option *ngFor="let ured of podrucniUredi" value="{{ured.nazivSluzbe}}">{{ured.nazivSluzbe}}</option>
                                </select>
                                <input
                                    type="text"
                                    formControlName="sifUred"
                                    class="form-control"
                                    style="width:50px;margin-top:-35px;margin-left:-40px;">
                                <mat-error
                                    *ngIf="(podrucniUred.touched || podrucniUred.dirty) && !podrucniUred.valid">
                                    <mat-error *ngIf="podrucniUred.errors['required']" style="margin-left:-250px;">Ovo polje je obvezno za unos!</mat-error>
                                    <mat-error *ngIf="podrucniUred.errors['uredIsForbidden'] && !podrucniUred.errors['required']" style="margin-left:-250px;">Ova vrijednost nije dozvoljena!</mat-error>
                                </mat-error>
                            </td>
                            <td colspan="2"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <input
                                    type="radio"
                                    value="ozljeda"
                                    formControlName="nacinPlacanja">Ozljeda na radu
                            </td>
                            <td>
                                <select class="form-control" style="width:200px;height:35px;margin-left:-250px;" formControlName="ozljeda">
                                    <option [disabled]="true" [ngValue]="null">Odaberite područni ured</option>
                                    <option *ngFor="let ured of podrucniUredi" value="{{ured.nazivSluzbe}}">{{ured.nazivSluzbe}}</option>
                                </select>
                                <input
                                    type="text"
                                    formControlName="sifUredOzljeda"
                                    class="form-control"
                                    style="width:50px;margin-top:-35px;margin-left:-40px;">
                                <mat-error
                                    *ngIf="(ozljeda.touched || ozljeda.dirty) && !ozljeda.valid">
                                    <mat-error *ngIf="ozljeda.errors['required']" style="margin-left:-250px;">Ovo polje je obvezno za unos!</mat-error>
                                    <mat-error *ngIf="ozljeda.errors['uredIsForbidden'] && !ozljeda.errors['required']" style="margin-left:-250px;">Ova vrijednost nije dozvoljena!</mat-error>
                                </mat-error>
                            </td>
                            <td colspan="2"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <input
                                    type="radio"
                                    value="poduzece"
                                    formControlName="nacinPlacanja">Poduzeće
                            </td>
                            <td>
                                <input
                                    type="text"
                                    placeholder="Unesite naziv poduzeća..."
                                    class="form-control"
                                    style="width:200px;margin-left:-250px;"
                                    formControlName="poduzece">
                                <mat-error
                                    *ngIf="(poduzece.touched || poduzece.dirty) && !poduzece.valid">
                                    <mat-error *ngIf="poduzece.errors?.required" style="margin-left:-250px;">Ovo polje je obvezno za unos!</mat-error>
                                </mat-error>
                            </td>
                            <td colspan="2"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <input
                                    type="radio"
                                    value="osobno"
                                    formControlName="nacinPlacanja">Osobno
                                <mat-error
                                    *ngIf="isSubmitted"
                                    style="display:block;">
                                    <mat-error
                                        *ngIf="nacinPlacanja.errors?.required">Unos načina plaćanja je obvezan za unos!</mat-error>
                                </mat-error>
                            </td>
                            <td colspan="3"></td>
                        </tr>
                        <tr>
                            <td>
                                <label
                                    for="kategorijaOsiguranja"
                                    style="font-family: Verdana, sans-serif;">Kategorija osiguranja:</label>
                            </td>
                            <td>
                                <select class="form-control" style="width:250px;height:38px" formControlName="kategorijaOsiguranja">
                                    <option [disabled]="true" [ngValue]="null">Odaberite kategoriju osiguranja</option>
                                    <option *ngFor="let kategorija of katOsiguranja" value="{{kategorija.opisOsiguranika}}">{{kategorija.opisOsiguranika}}</option>
                                </select>
                                <input
                                    type="text"
                                    formControlName="oznakaOsiguranika"
                                    class="form-control"
                                    style="width:50px;margin-left:255px;margin-top:-38px;height:38px;">
                                <mat-error
                                    *ngIf="(kategorijaOsiguranja.touched || kategorijaOsiguranja.dirty) && !kategorijaOsiguranja.valid">
                                    <mat-error *ngIf="kategorijaOsiguranja.errors['required']">Ovo polje je obvezno za unos!</mat-error>
                                    <mat-error *ngIf="kategorijaOsiguranja.errors['opisIsForbidden'] && !kategorijaOsiguranja.errors['required']">Ova vrijednost nije dozvoljena!</mat-error>
                                </mat-error>
                            </td>
                            <td colspan="3"></td>
                        </tr>
                        <tr>
                            <td>
                                <label
                                    for="drzavaOsiguranja"
                                    style="font-family: Verdana, sans-serif;">Država osiguranja:</label>
                            </td>
                            <td>
                                <select class="form-control" style="width:250px;height:35px" formControlName="drzavaOsiguranja">
                                    <option [disabled]="true" [ngValue]="null">Odaberite državu osiguranja</option>
                                    <option *ngFor="let drzava of drzave" value="{{drzava.nazivDrzave}}">{{drzava.nazivDrzave}}</option>
                                </select>
                                <mat-error *ngIf="(drzavaOsiguranja.touched || drzavaOsiguranja.dirty) && !drzavaOsiguranja.valid">
                                    <mat-error *ngIf="drzavaOsiguranja.errors['required']">Ovo polje je obvezno za unos!</mat-error>
                                    <mat-error *ngIf="drzavaOsiguranja.errors['drzaveIsForbidden'] && !drzavaOsiguranja.errors['required']">Ova vrijednost nije dozvoljena!</mat-error>
                                </mat-error>
                            </td>
                            <td colspan="3"></td>
                        </tr>
                        <tr>
                            <td>
                                <label
                                    for="mbrPacijent"
                                    style="font-family: Verdana, sans-serif;">Matični broj pacijenta:</label>
                            </td>
                            <td>
                                <input
                                    type="text"
                                    formControlName="mbrPacijent"
                                    class="form-control"
                                    placeholder="Unesite matični broj pacijenta.."
                                    style="width:250px;">
                                <mat-error *ngIf="(mbrPacijent.touched || mbrPacijent.dirty) && !mbrPacijent.valid">
                                    <mat-error *ngIf="mbrPacijent.errors['pattern']">Morate unijeti ispravan format MBO-a!</mat-error>
                                    <mat-error *ngIf="mbrPacijent.errors['required']">Ovo polje je obvezno za unos!</mat-error>
                                    <mat-error *ngIf="mbrPacijent.errors?.nePostojiMBO && !mbrPacijent.errors['pattern'] && !mbrPacijent.errors['required']">Nesipravan MBO!</mat-error>
                                </mat-error>
                            </td>
                            <td colspan="3"></td>
                        </tr>
                        <tr>
                            <td>
                                <h4 style="font-family: Verdana, sans-serif;">Dopunsko osiguranje</h4>
                            </td>
                            <td colspan="4"></td>
                        </tr>
                        <tr>
                            <td>
                                <label
                                    for="brIskDopunsko"
                                    style="font-family: Verdana, sans-serif;">Broj iskaznice dopunskog osiguranja:</label>
                            </td>
                            <td>
                                <input
                                    type="text"
                                    formControlName="brIskDopunsko"
                                    class="form-control"
                                    placeholder="Unesite broj iskaznice dopunskog osiguranja.."
                                    style="width:250px;">
                                <mat-error *ngIf="(brIskDopunsko.touched || brIskDopunsko.dirty) && !brIskDopunsko.valid">
                                    <mat-error *ngIf="brIskDopunsko.errors?.required">Morate unijeti broj iskaznice dopunskog osiguranja!</mat-error>
                                    <mat-error *ngIf="brIskDopunsko.errors?.pattern">Morate unijeti ispravan format broja iskaznice dopunskog osiguranja!</mat-error>
                                    <mat-error *ngIf="brIskDopunsko.errors?.nePostojiBrojDopunsko && !brIskDopunsko.errors?.required && !brIskDopunsko.errors?.pattern">Neispravan broj iskaznice dopunskog osiguranja!</mat-error>
                                </mat-error>
                            </td>
                            <td colspan="3"></td>
                        </tr>
                        <tr>
                            <td colspan="5">
                                <h4 style="font-family: Verdana, sans-serif;">Dijagnoze</h4>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="primarnaDijagnoza"
                                    style="margin-top:8px;font-family: Verdana, sans-serif;">Primarna dijagnoza:</label></td>
                            <td>
                                <select class="form-control" style="width:350px;height:35px" formControlName="primarnaDijagnoza">
                                    <option [disabled]="true" [ngValue]="null">Odaberite dijagnozu</option>
                                    <option *ngFor="let dijagnoza of dijagnoze" value="{{dijagnoza.imeDijagnoza}}">{{dijagnoza.imeDijagnoza}}</option>
                                </select>
                                <mat-error
                                    *ngIf="primarnaDijagnoza.value">
                                    <mat-error *ngIf="primarnaDijagnoza.errors?.neispravanNazivDijagnoza">Neispravan unos primarne dijagnoze!</mat-error>
                                </mat-error>
                            </td>
                            <td>
                                <input
                                    type="text"
                                    class="form-control"
                                    style="width:100px;height:35px"
                                    formControlName="mkbPrimarnaDijagnoza"
                                    placeholder="MKB šifra">
                                <mat-error
                                    *ngIf="((mkbPrimarnaDijagnoza.touched || mkbPrimarnaDijagnoza.dirty) && !mkbPrimarnaDijagnoza.valid)">
                                    <mat-error *ngIf="mkbPrimarnaDijagnoza.errors?.neispravanMKB">Neispravan unos MKB šifre!</mat-error>
                                </mat-error>
                            </td>
                            <td colspan="2"></td>
                        </tr>
                        <tr formArrayName="sekundarnaDijagnoza" *ngFor="let dijagnozaCtrl of getControlsSekundarna(); let i = index">
                            <ng-container [formGroupName]="i">
                                    <td><label for="sekundarnaDijagnoza"
                                                *ngIf="i<1"
                                                style="font-family: Verdana, sans-serif;margin-top:6px;">Sekundarna dijagnoza:</label></td>
                                    <td>
                                        <select
                                            class="form-control"
                                            style="width:350px;height:35px;"
                                            formControlName="nazivSekundarna"
                                            (change)="onChangeNazivSekundarna(dijagnozaCtrl.value.nazivSekundarna,i)">
                                            <option [disabled]="true" [ngValue]="null">Odaberite dijagnozu</option>
                                            <option *ngFor="let dijagnoza of dijagnoze" value="{{dijagnoza.imeDijagnoza}}">{{dijagnoza.imeDijagnoza}}</option>
                                        </select>
                                        <mat-error
                                            *ngIf="(dijagnozaCtrl.touched || dijagnozaCtrl.dirty) && !dijagnozaCtrl.valid">
                                            <mat-error
                                                *ngIf="dijagnozaCtrl.errors?.requiredMKB">MKB šifra je obvezna za unos!</mat-error>
                                            <mat-error
                                                *ngIf="!dijagnozaCtrl.errors?.requiredMKB && dijagnozaCtrl.errors?.neispravanMKB"
                                                style="display: block;">Neispravan unos MKB šifre!</mat-error>
                                            <mat-error
                                                *ngIf="!dijagnozaCtrl.errors?.requiredMKB && dijagnozaCtrl.errors?.requiredNazivSekundarna"
                                                style="display: block;">Naziv sekundarne dijagnoze je obvezan za unos!</mat-error>
                                        </mat-error>
                                        <mat-error
                                            *ngIf="!sekundarnaDijagnoza.valid">
                                            <!--Prikaži samo ako se pojavio error i PRIKAŽI SAMO NA ZADNJEM FORM CONTROLU-->
                                            <mat-error
                                                *ngIf="sekundarnaDijagnoza.errors?.duplikat && dijagnozaCtrl.value.nazivSekundarna === sekDijagnoza"
                                                style="display: block;">Duplikati nisu dozvoljeni!</mat-error>
                                        </mat-error>
                                        <mat-error
                                            *ngIf="((dijagnozaCtrl.touched || dijagnozaCtrl.dirty) ||
                                            (primarnaDijagnoza.touched || primarnaDijagnoza.dirty) ||
                                            (mkbPrimarnaDijagnoza.touched || mkbPrimarnaDijagnoza.dirty)) && !forma.valid">
                                            <mat-error *ngIf="forma.errors?.primarnaJeIstaKaoSekundarna && dijagnozaCtrl.value.nazivSekundarna === dijagnoza"
                                                style="display:block;">Ovu dijagnozu ste unijeli kao primarnu dijagnozu!</mat-error>
                                        </mat-error>
                                    </td>
                                    <td>
                                        <input
                                            type="text"
                                            class="form-control"
                                            style="width:100px;height:35px;"
                                            formControlName="mkbSifraSekundarna"
                                            placeholder="MKB šifra"
                                            (input)="onChangeMKB(dijagnozaCtrl.value.mkbSifraSekundarna,i)">
                                    </td>
                                    <td colspan="2">
                                        <button
                                            type="button"
                                            class="btn btn-danger"
                                            (click)="onDeleteDiagnosis(i)">X</button>
                                    </td>
                            </ng-container>
                        </tr>
                        <tr>
                            <td></td>
                            <!--BUTTON JE DISABLED AKO DIJAGNOZE NISU ISPRAVNE-->
                            <td><button
                                    type="button"
                                    class="btn btn-info"
                                    (click)="onAddDiagnosis()"
                                    [disabled]="sekundarnaDijagnoza.errors?.duplikat ||
                                            forma.errors?.primarnaJeIstaKaoSekundarna ||
                                            !primarnaDijagnoza.value ||
                                            !isAktivan">Dodaj sekunardnu dijagnozu</button></td>
                            <td colspan="3"></td>
                        </tr>
                        <tr formGroupName="tipSlucaj">
                            <td>
                                <input
                                    type="checkbox"
                                    formControlName="noviSlucaj"
                                    value="noviSlucaj"
                                    *ngIf="!ponistiPovezaniSlucaj">
                                <label
                                    for="noviSlucaj"
                                    style="margin-left:2px;font-family: Verdana, sans-serif"
                                    *ngIf="!ponistiPovezaniSlucaj">Novi slučaj</label>
                                <mat-error
                                    *ngIf="isSubmitted"
                                    style="display:block;">
                                    <mat-error
                                        *ngIf="tipSlucaj.errors?.baremJedanTipSlucaj">Morate odabrati barem jedan tip slučaja!</mat-error>
                                </mat-error>
                                <input
                                    type="checkbox"
                                    formControlName="povezanSlucaj"
                                    value="povezanSlucaj"
                                    *ngIf="ponistiPovezaniSlucaj">
                                <label
                                    for="povezanSlucaj"
                                    style="margin-left:2px;font-family: Verdana, sans-serif"
                                    *ngIf="ponistiPovezaniSlucaj">Povezani slučaj</label>
                            </td>
                            <td><a
                                    *ngIf="!ponistiPovezaniSlucaj"
                                    (click)="onOpenCase()"
                                    style="color:#337ab7;cursor: pointer;font-weight: bold;font-family: Verdana, sans-serif;">Otvoreni slučaj</a>
                                <a
                                    *ngIf="ponistiPovezaniSlucaj"
                                    (click)="onPonistiPovezaniSlucaj()"
                                    style="color:#337ab7;cursor: pointer;font-weight: bold;font-family: Verdana, sans-serif;">Poništi povezani slučaj</a>
                            </td>
                            <td colspan="3"></td>
                        </tr>
                        <tr>
                            <!--Sve dok podatci u formi nisu ispravno uneseni, button se neće moći stisnuti-->
                            <td colspan="5">
                                <button
                                    type="submit"
                                    class="btn btn-primary"
                                    style="margin:auto;display:block;">Potvrdi opće podatke</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </form>
    </div>
</div>
